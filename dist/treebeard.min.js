!function(t,e){"use strict";var o;"function"==typeof define&&define.amd?define(["jQuery","mithril"],e):"object"==typeof exports?("undefined"!=typeof webpackJsonp&&require("./treebeard.css"),o=require("mithril"),module.exports=e(jQuery,o)):(o=t.m,t.Treebeard=e(jQuery,o))}(this,function(t,e){"use strict";function o(){return window.treebeardCounter=window.treebeardCounter+1,window.treebeardCounter}function n(t){return t?$.isFunction(t)?t():t:""}function i(t,e){return"number"===e?function(e,o){var n=e.data[t]?e.data[t]:0,i=o.data[t]?o.data[t]:0,s=n-i;return 0===s?e.id-o.id:s}:"date"===e?function(e,o){var n=new Date(e.data[t]?e.data[t]:0),i=new Date(o.data[t]?o.data[t]:0),s=n-i;return 0===s?e.id-o.id:s}:function(e,o){var n=e.data[t]?e.data[t].toString().toLowerCase().replace(/\s/g,"").trim():"",i=o.data[t]?o.data[t].toString().toLowerCase().replace(/\s/g,"").trim():"";return i>n?-1:n>i?1:e.id<o.id?-1:1}}function s(t,e){return"number"===e?function(e,o){var n=e.data[t]?e.data[t]:0,i=o.data[t]?o.data[t]:0,s=i-n;return 0===s?o.id-e.id:s}:"date"===e?function(e,o){var n=new Date(e.data[t]?e.data[t]:0),i=new Date(o.data[t]?o.data[t]:0),s=i-n;return 0===s?o.id-e.id:s}:function(e,o){var n=e.data[t]?e.data[t].toString().toLowerCase().replace(/\s/g,""):"",i=o.data[t]?o.data[t].toString().toLowerCase().replace(/\s/g,""):"";return n>i?-1:i>n?1:e.id>o.id?-1:1}}function r(t,e,o){var n,i=!1;for(n=0;n<t.length;n++)if(t[n]&&t[n].hasOwnProperty(e)&&arguments.length>2&&t[n][e]===o)return t.splice(n,1),i=!0;return i}var a=e.request;e.request=function(){var t,e=arguments[0];return t=-1!==e.url.indexOf("?")?"&_=":"?_=",e.url+=t+(new Date).getTime(),a.apply(this,arguments)};var l,d,c,h=function(t,e,o){var n,i,s,r,a,l=function(){var d=(new Date).getTime()-r;e>d&&d>=0?n=setTimeout(l,e-d):(n=null,o||(a=t.apply(s,i),n||(s=i=null)))};return function(){s=this,i=arguments,r=(new Date).getTime();var d=o&&!n;return n||(n=setTimeout(l,e)),d&&(a=t.apply(s,i),s=i=null),a}},p={},u={};window.treebeardCounter||(window.treebeardCounter=-1);var f=3e3;d=function(t,o,n,i){this.column=n||null,this.type=o||"info",this.message=t||"Hello",this.on=!1,this.timeout=void 0===i?f:i,this.css="",this.toggle=function(){this.on=!this.on},this.show=function(){this.on=!0;var t=this;t.timeout&&t.timeout>1&&setTimeout(function(){t.hide()},t.timeout),e.redraw(!0)},this.hide=function(){this.on=!1,e.redraw(!0)},this.update=function(t,e,o,n,i){this.type=e||this.type,this.column=o||this.column,this.timeout=void 0===n?f:n,this.message=t,this.css=i||"",this.show(!0)},this.selfDestruct=function(t,e,o){this.on=!1,this.on=!0;var n=this,i=o||3e3;setTimeout(function(){n.hide(),e.removeSelf(),t.redraw()},i)}},c=function(t){var o=t.select("#tb-tbody"),n=this;this.on=!1,this.timeout=!1,this.css="",this.padding="50px 100px;",this.header=null,this.content=null,this.actions=null,this.height=o.height(),this.width=o.width(),this.dismiss=function(){this.on=!1,e.redraw(!0),t.select("#tb-tbody").css("overflow","auto")},this.show=function(){this.on=!0,n.timeout&&setTimeout(function(){n.dismiss()},n.timeout),e.redraw(!0)},this.toggle=function(){this.on=!this.on,e.redraw(!0)},this.update=function(t,o,i){n.updateSize(),i&&(this.header=i),t&&(this.content=t),o&&(this.actions=o),this.on=!0,e.redraw(!0)},this.updateSize=function(){this.height=t.select("#tb-tbody").height(),this.width=t.select("#tb-tbody").width(),this.padding=this.width<500?"40px":"50px 100px",e.redraw(!0)},this.onmodalshow=function(){var e=t.select("#tb-tbody").scrollTop();t.select(".tb-modal-shade").css("margin-top",e),t.select("#tb-tbody").css("overflow","hidden")},$(window).resize(function(){n.updateSize()})},l=function(t){void 0===t?(this.data={},this.kind="folder",this.open=!0):(this.data=t,this.kind=t.kind||"file",this.open=t.open),"folder"===this.kind&&(this.load=!1),this.id=o(),this.depth=0,this.children=[],this.parentID=null,this.notify=new d},l.prototype.add=function(t,e){return t.parentID=this.id,t.depth=this.depth+1,t.open=!1,t.load=!1,t.depth>1&&0===t.children.length&&(t.open=!1),e?this.children.unshift(t):this.children.push(t),this},l.prototype.move=function(t,e){var o=p[t],n=this.parentID,i=p[n];return o.add(this,e),o.redoDepth(),n>-1&&i.removeChild(parseInt(this.id,10)),this},l.prototype.redoDepth=function(){function t(e,o){var n;for(n=0;n<e.length;n++)e[n].depth=o,e[n].children.length>0&&t(e[n].children,o+1)}t(this.children,this.depth+1)},l.prototype.removeSelf=function(){var t=this.parent();return t.removeChild(this.id),t},l.prototype.removeChild=function(t){return r(this.children,"id",t),this},l.prototype.next=function(){var t,e,o;for(e=p[this.parentID],o=0;o<e.children.length;o++)if(e.children[o].id===this.id)return t=e.children[o+1];if(!t)throw new Error("Treebeard Error: Item with ID '"+this.id+"' has no next sibling")},l.prototype.prev=function(){var t,e,o;for(e=p[this.parentID],o=0;o<e.children.length;o++)if(e.children[o].id===this.id)return t=e.children[o-1];if(!t)throw new Error("Treebeard Error: Item with ID '"+this.id+"' has no previous sibling")},l.prototype.child=function(t){var e,o;for(o=0;o<this.children.length;o++)if(this.children[o].id===t)return e=this.children[o];if(!e)throw new Error("Treebeard Error: Parent with ID '"+this.id+"' has no child with ID: "+t)},l.prototype.parent=function(){return p[this.parentID]?p[this.parentID]:void 0},l.prototype.sortChildren=function(t,e,o,n,r){var a=t.options.resolveRows.call(t,this),l=a[n].data;if(!e||"asc"!==e&&"desc"!==e)throw new Error("Treebeard Error: To sort children you need to pass direction as asc or desc to Item.sortChildren");this.depth>=r&&this.children.length>0&&("asc"===e&&this.children.sort(i(l,o)),"desc"===e&&this.children.sort(s(l,o)))},l.prototype.isAncestor=function(t){function e(t,o){return t.id===o.id?!0:t.parent()?e(t.parent(),o):!1}return t.parent()?e(t.parent(),this):!1},l.prototype.isDescendant=function(t){function e(t,i){for(o=0;o<t.length;o++){if(t[o].id===i.id){n=!0;break}if(t[o].children.length>0)return e(t[o].children,i)}return n}var o,n=!1;return e(t.children,this)},u.controller=function(t){function o(){i.dropzone.destroy()}function n(){i.dropzone&&o();var t,e=$.extend({clickable:!1,counter:0,accept:function(t,e){var o=t.treebeardParent;i.options.addcheck.call(this,i,o,t)&&$.when(i.options.resolveUploadUrl.call(i,o,t)).then(function(t){if(t&&(i.dropzone.options.url=t,i.dropzone.options.counter++,i.dropzone.options.counter<2)){var e=i.returnIndex(o.id);o.open||i.toggleFolder(e,null)}return t}).then(function(){$.isFunction(i.options.resolveUploadMethod)&&(i.dropzone.options.method=i.options.resolveUploadMethod.call(i,o))}).done(function(){e()})},drop:function(t){var e=$(t.target).closest(".tb-row").attr("data-id"),o=p[e];if("file"===o.kind&&(o=o.parent()),i.dropzoneItemCache=o,!o.open){var n=i.returnIndex(o.id);i.toggleFolder(n,null)}$.isFunction(i.options.dropzoneEvents.drop)&&i.options.dropzoneEvents.drop.call(this,i,t)},dragstart:function(t){$.isFunction(i.options.dropzoneEvents.dragstart)&&i.options.dropzoneEvents.dragstart.call(this,i,t)},dragend:function(t){$.isFunction(i.options.dropzoneEvents.dragend)&&i.options.dropzoneEvents.dragend.call(this,i,t)},dragenter:function(t){$.isFunction(i.options.dropzoneEvents.dragenter)&&i.options.dropzoneEvents.dragenter.call(this,i,t)},dragover:function(t){$.isFunction(i.options.dropzoneEvents.dragover)&&i.options.dropzoneEvents.dragover.call(this,i,t)},dragleave:function(t){$.isFunction(i.options.dropzoneEvents.dragleave)&&i.options.dropzoneEvents.dragleave.call(this,i,t)},success:function(t,e){$.isFunction(i.options.dropzoneEvents.success)&&i.options.dropzoneEvents.success.call(this,i,t,e),$.isFunction(i.options.onadd)&&i.options.onadd.call(this,i,t.treebeardParent,t,e)},error:function(t,e,o){$.isFunction(i.options.dropzoneEvents.error)&&i.options.dropzoneEvents.error.call(this,i,t,e,o)},uploadprogress:function(t,e,o){$.isFunction(i.options.dropzoneEvents.uploadprogress)&&i.options.dropzoneEvents.uploadprogress.call(this,i,t,e,o)},sending:function(t,e,o){var n=this.getQueuedFiles();i.isUploading(n.length>0?!0:!1),$.isFunction(i.options.dropzoneEvents.sending)&&i.options.dropzoneEvents.sending.call(this,i,t,e,o)},complete:function(t){$.isFunction(i.options.dropzoneEvents.complete)&&i.options.dropzoneEvents.complete.call(this,i,t)},queuecomplete:function(t){i.isUploading(!1),$.isFunction(i.options.dropzoneEvents.quecomplete)&&i.options.dropzoneEvents.complete.call(this,i,t)},addedfile:function(t){t.treebeardParent=i.dropzoneItemCache,$.isFunction(i.options.dropzoneEvents.addedfile)&&i.options.dropzoneEvents.addedfile.call(this,i,t)}},i.options.dropzone);if(t="object"==typeof module?require("dropzone"):window.Dropzone,"undefined"==typeof t)throw new Error('To enable uploads Treebeard needs "Dropzone" to be installed.');i.dropzone=new t("#"+i.options.divID,e)}var i=this;this.isSorted={},e.redraw.strategy("all"),this.flatData=[],this.treeData={},this.filterText=e.prop(""),this.showRange=[],this.options=t.options,this.selected=void 0,this.rangeMargin=0,this.visibleIndexes=[],this.visibleTop=void 0,this.currentPage=e.prop(1),this.dropzone=null,this.dropzoneItemCache=void 0,this.filterOn=!1,this.multiselected=e.prop([]),this.pressedKey=void 0,this.dragOngoing=!1,this.initialized=!1,this.colsizes={},this.tableWidth=e.prop("auto;"),this.isUploading=e.prop(!1),this.redraw=function(){i.flatten(i.treeData.children,i.visibleTop)},this.mredraw=function(){e.redraw()},this.select=function(t){return $("#"+i.options.divID+" "+t)},this.modal=new c(this),this.resetCounter=function(t){window.treebeardCounter=0!==t?t||-1:0},this.initializeMove=function(){var t,e,o,n;t={helper:"clone",cursor:"move",containment:".tb-tbody-inner",delay:100,drag:function(t,e){if(27===i.pressedKey)return!1;if(i.options.dragEvents.drag)i.options.dragEvents.drag.call(i,t,e);else{if(""===i.dragText&&i.multiselected().length>1){var s=$(e.helper).text()+" <b> + "+(i.multiselected().length-1)+" more </b>";i.dragText=s,$(".tb-drag-ghost").html(s)}$(e.helper).css({display:"none"})}o=t.pageX>50?t.pageX-50:50,n=t.pageY-10,$(".tb-drag-ghost").css({position:"absolute",top:n,left:o,height:"25px",width:"400px",background:"white",padding:"0px 10px","box-shadow":"0 0 4px #ccc"})},create:function(t,e){i.options.dragEvents.create&&i.options.dragEvents.create.call(i,t,e)},start:function(t,e){var o,n,s;o=parseInt($(e.helper).closest(".tb-row").attr("data-id"),10),n=i.find(o),i.isMultiselected(o)||(i.clearMultiselect(),i.multiselected().push(n)),i.dragText="",s=$(e.helper).clone(),s.addClass("tb-drag-ghost"),$("body").append(s),i.options.dragEvents.start&&i.options.dragEvents.start.call(i,t,e),i.dragOngoing=!0,i.select(".tb-row").removeClass(i.options.hoverClass+" tb-h-error tb-h-success")},stop:function(t,e){$(".tb-drag-ghost").remove(),i.options.dragEvents.stop&&i.options.dragEvents.stop.call(i,t,e),i.dragOngoing=!1,i.select(".tb-row").removeClass(i.options.hoverClass+" tb-h-error tb-h-success")}},e={tolerance:"pointer",activate:function(t,e){i.options.dropEvents.activate&&i.options.dropEvents.activate.call(i,t,e)},create:function(t,e){i.options.dropEvents.create&&i.options.dropEvents.create.call(i,t,e)},deactivate:function(t,e){i.options.dropEvents.deactivate&&i.options.dropEvents.deactivate.call(i,t,e)},drop:function(t,e){i.options.dropEvents.drop&&i.options.dropEvents.drop.call(i,t,e)},out:function(t,e){i.options.dropEvents.out&&i.options.dropEvents.out.call(i,t,e)},over:function(t,e){var o=parseInt($(t.target).closest(".tb-row").attr("data-id"),10);i.scrollEdges(o),i.options.dropEvents.over&&i.options.dropEvents.over.call(i,t,e)}},i.options.finalDragOptions=$.extend(t,i.options.dragOptions),i.options.finalDropOptions=$.extend(e,i.options.dropOptions),i.options.dragSelector=i.options.moveClass||"td-title",i.moveOn()},this.scrollEdges=function(t,e){var e=e||1,o=i.flatData[i.showRange[i.showRange.length-1-e]].id,n=i.flatData[i.showRange[0+e]].id,s=i.select("#tb-tbody").scrollTop();t===o&&i.select("#tb-tbody").scrollTop(s+i.options.rowHeight+1),t===n&&i.select("#tb-tbody").scrollTop(s-i.options.rowHeight-1)},this.moveOn=function(t){t?($(t).find("."+i.options.dragSelector).draggable(i.options.finalDragOptions),$(t).droppable(i.options.finalDropOptions)):(i.select("."+i.options.dragSelector).draggable(i.options.finalDragOptions),i.select(".tb-row").droppable(i.options.finalDropOptions))},this.moveOff=function(){i.select(".td-title").draggable("destroy"),i.select(".tb-row").droppable("destroy")},this.deleteNode=function(t,e){var o=p[e],n=$.extend({},o);return $.when(i.options.deletecheck.call(i,o)).done(function(o){if(o){var s=p[t];s.removeChild(e),i.flatten(i.treeData.children,i.visibleTop),i.options.ondelete&&i.options.ondelete.call(i,n)}}),n},this.canMove=function(t,e){return"folder"!==t.kind?!1:t.isDescendant(e)?!1:!0},this.createItem=function(t,e){var o,n=p[e];return $.when(i.options.createcheck.call(i,t,n)).done(function(e){if(!e)throw new Error("Treebeard Error: createcheck function returned false, item not created.");o=new l(t),n.add(o,!0),i.flatten(i.treeData.children,i.visibleTop),i.options.oncreate&&i.options.oncreate.call(i,o,n)}),o},this.find=function(t){return p[t]?p[t]:void 0},this.returnIndex=function(t){var e,o,n=i.flatData.length;for(e=0;n>e;e++)if(o=i.flatData[e],o.id===t)return e;return void 0},this.returnRangeIndex=function(t){var e,o,n=i.showRange.length;for(e=0;n>e;e++)if(o=i.flatData[i.showRange[e]],o.id===t)return e;return void 0},this.rowFilterResult=function(t){$("#tb-tbody").scrollTop(0),i.currentPage(1);var e,o,n,s=i.options.resolveRows.call(i,t),r=i.filterText().toLowerCase(),a=!1;for(e=0;e<s.length;e++)n=s[e],n.filter&&-1!==t.data[n.data].toString().toLowerCase().indexOf(r)&&(a=!0);var l=i.options.hiddenFilterRows;if(l&&l.length>0)for(o=0;o<l.length;o++)-1!==t.data[l[o]].toString().toLowerCase().indexOf(r)&&(a=!0);return a},this.filter=function(t){e.withAttr("value",i.filterText)(t);var o=i.filterText().toLowerCase(),n=i.visibleTop;0===o.length?i.resetFilter():(i.filterOn||(i.filterOn=!0,i.lastNonFilterLocation=i.lastLocation),i.visibleTop||(n=0),i.calculateVisible(n),i.calculateHeight(),e.redraw(!0),i.options.onfilter&&i.options.onfilter.call(i,o))},this.resetFilter=function(t){var o=this,n=t||i.lastNonFilterLocation,s=i.filterText().toLowerCase();o.filterOn=!1,o.calculateVisible(0),o.calculateHeight(),e.redraw(!0),i.select("#tb-tbody").scrollTop(n),o.options.onfilterreset&&o.options.onfilterreset.call(o,s)},this.addChildren=function(t,e){e.children=[];var o,n;for(n=0;n<t.length;n++)o=i.buildTree(t[n],e),e.add(o);e.open=!0},this.updateFolder=function(t,e,o){t&&i.addChildren(t,e);var n=i.returnIndex(e.id);e.open=!1,e.load=!1,i.toggleFolder(n,null,o)},this.toggleFolder=function(t,o,n){if(void 0===t||null===t)return void i.redraw();var s,r,a,l,d,c,h=i.flatData.length,u=p[i.flatData[t].id],f=i.flatData[t],g=!1,v=f.depth,w=f.depth,b=$('.tb-row[data-id="'+f.id+'"]').find(".tb-toggle-icon");b.get(0)&&e.render(b.get(0),i.options.resolveRefreshIcon()),$.when(i.options.resolveLazyloadUrl.call(i,u)).done(function(m){if(c=m,c&&"folder"===f.row.kind&&u.open===!1&&u.load===!1)u.children=[],e.request({method:"GET",url:c,config:i.options.xhrconfig}).then(function(t){if(t){i.options.lazyLoadPreprocess&&(t=i.options.lazyLoadPreprocess.call(i,t)),$.isArray(t)||(t=t.data);var o=function(t){return t.data.tmpID};for(u.children=u.children.filter(o),r=0;r<t.length;r++)s=i.buildTree(t[r],u),u.add(s);u.open=!0,u.load=!0,y=i.options.resolveToggle.call(i,u),b.get(0)&&e.render(b.get(0),y)}else i.options.lazyLoadError.call(i,u),y=i.options.resolveToggle.call(i,u),b.get(0)&&e.render(b.get(0),y)},function(){i.options.lazyLoadError.call(i,u),y=i.options.resolveToggle.call(i,u),b.get(0)&&e.render(b.get(0),y)}).then(function(){i.flatten(i.treeData.children,i.visibleTop),i.options.lazyLoadOnLoad&&i.options.lazyLoadOnLoad.call(i,u,o),i.options.ontogglefolder&&i.options.ontogglefolder.call(i,u,o),n&&n.call(i,u,o)});else{for(a=t+1;h>a&&(l=i.flatData[a],d=p[i.flatData[a].id],!(l.depth<=w));a++)g&&l.depth>v||(l.depth===v&&(g=!1),u.open?l.show=!1:(l.show=!0,d.open||(v=l.depth,g=!0)));u.open=!u.open,i.calculateVisible(i.visibleTop),i.calculateHeight(),e.redraw(!0);var y=i.options.resolveToggle.call(i,u);b.get(0)&&e.render(b.get(0),y),i.options.ontogglefolder&&i.options.ontogglefolder.call(i,u,o)}i.options.allowMove&&i.moveOn()})},this.sortToggle=function(t,e,o,n){var s,r,a=0;t&&(r=$(t.target),o=r.attr("data-direction"),e=parseInt(r.parent(".tb-th").attr("data-tb-th-col")),n=r.attr("data-sortType")),i.select(".asc-btn, .desc-btn").addClass("tb-sort-inactive"),i.isSorted[e].asc=!1,i.isSorted[e].desc=!1,i.isSorted[e][o]||(s=function(t){t.map(function(t){t.sortChildren(i,o,n,e,i.options.sortDepth),t.children.length>0&&s(t.children),a+=1})},i.treeData.sortChildren(i,o,n,e,i.options.sortDepth),s(i.treeData.children),i.select("div[data-tb-th-col="+e+"]").children("."+o+"-btn").removeClass("tb-sort-inactive"),i.isSorted[e][o]=!0,i.flatten(i.treeData.children,0))},this.calculateHeight=function(){var t;return i.options.paginate?(t=i.options.showTotal*i.options.rowHeight,i.rangeMargin=0):t=i.visibleIndexes.length*i.options.rowHeight,i.innerHeight=t+i.remainder,t},this.calculateVisible=function(t){t=t||0;var e,o,n=i.flatData.length,s=0;for(i.visibleIndexes=[],e=0;n>e;e++)o=p[i.flatData[e].id],i.filterOn?i.rowFilterResult(o)&&(s++,i.visibleIndexes.push(e)):i.flatData[e].show&&(i.visibleIndexes.push(e),s+=1);return i.refreshRange(t),s},this.refreshRange=function(t,o){o=void 0!==o?o:!0;var n,s,r=i.visibleIndexes.length,a=[],l=0;for((!t||t>i.flatData.length)&&(t=0),i.visibleTop=t,n=t;r>n&&a.length!==i.options.showTotal;n++)s=i.visibleIndexes[n],a.push(s),l+=1;i.showRange=a,o&&e.redraw(!0)},this.toggleScroll=function(){i.options.paginate=!1,i.select(".tb-paginate").removeClass("active"),i.select(".tb-scroll").addClass("active"),i.select("#tb-tbody").scrollTop((i.currentPage()-1)*i.options.showTotal*i.options.rowHeight),i.calculateHeight()},this.togglePaginate=function(){var t=i.showRange[0],e=i.visibleIndexes.indexOf(t),o=Math.floor(e/i.options.showTotal),n=o*i.options.showTotal;i.options.paginate=!0,i.select(".tb-scroll").removeClass("active"),i.select(".tb-paginate").addClass("active"),i.currentPage(o+1),i.calculateHeight(),i.refreshRange(n)},this.pageUp=function(){var t=i.showRange[i.options.showTotal-1],e=i.visibleIndexes.indexOf(t);return e>-1&&e+1<i.visibleIndexes.length?(i.refreshRange(e+1),i.currentPage(i.currentPage()+1),!0):!1},this.pageDown=function(){var t=i.showRange[0],e=i.visibleIndexes.indexOf(t);return e&&e>0?(i.refreshRange(e-i.options.showTotal),i.currentPage(i.currentPage()-1),!0):!1},this.goToPage=function(t){if(t&&t>0&&t<=Math.ceil(i.visibleIndexes.length/i.options.showTotal)){var e=i.options.showTotal*(t-1);return i.currentPage(t),i.refreshRange(e),!0}return!1},this.isMultiselected=function(t){var e=!1;return i.multiselected().map(function(o){o.id===t&&(e=!0)}),e},this.removeMultiselected=function(t){return i.multiselected().map(function(e,o,n){e.id===t&&(n.splice(o,1),$('.tb-row[data-id="'+e.id+'"]').removeClass(i.options.hoverClassMultiselect))}),!1},this.highlightMultiselect=function(){$("."+i.options.hoverClassMultiselect).removeClass(i.options.hoverClassMultiselect),i.multiselected().map(function(t){$('.tb-row[data-id="'+t.id+'"]').addClass(i.options.hoverClassMultiselect)})},this.handleMultiselect=function(t,e,o){var n,s,r,a,l,d=p[t];if(i.options.onbeforemultiselect&&i.options.onbeforemultiselect.call(i,o,d),16===i.pressedKey)if(0===i.multiselected().length)i.multiselected().push(d);else if(n=i.returnRangeIndex(i.multiselected()[0].id),s=i.returnRangeIndex(t),l=n>s?"up":"down",n!==s){if(i.multiselected([]),"down"===l)for(r=n;s+1>r;r++)i.multiselected().push(p[i.flatData[i.showRange[r]].id]);if("up"===l)for(r=n;r>s-1;r--)i.multiselected().push(p[i.flatData[i.showRange[r]].id])}a=91,(window.navigator.userAgent.indexOf("MSIE")>-1||window.navigator.userAgent.indexOf("Windows")>-1)&&(a=17),window.navigator.userAgent.indexOf("Firefox")>-1&&(a=224),i.pressedKey===a&&(i.isMultiselected(d.id)?i.removeMultiselected(d.id):i.multiselected().push(d)),i.pressedKey||(i.clearMultiselect(),i.multiselected().push(d)),i.options.onmultiselect&&i.options.onmultiselect.call(i,o,d),i.highlightMultiselect.call(this)},this.clearMultiselect=function(){$("."+i.options.hoverClassMultiselect).removeClass(i.options.hoverClassMultiselect),i.multiselected([])},this.multiSelectArrows=function(t){$.isFunction(i.options.onbeforeselectwitharrow)&&i.options.onbeforeselectwitharrow.call(this,i.multiselected()[0],t);var e="down"===t?1:-1,o=i.returnIndex(i.multiselected()[0].id),n=i.visibleIndexes.indexOf(o),s=n+e,r=i.flatData[i.visibleIndexes[s]];if(r){var a=i.find(r.id);i.multiselected([a]),i.scrollEdges(a.id,0),i.highlightMultiselect.call(i),$.isFunction(i.options.onafterselectwitharrow)&&i.options.onafterselectwitharrow.call(this,r,t)}},this.keyboardFolderToggle=function(t){var e=i.multiselected()[0];if("folder"===e.kind&&(e.open===!0&&"close"===t||e.open===!1&&"open"===t)){var o=i.returnIndex(e.id);i.toggleFolder(o,null)}},this.handleArrowKeys=function(t){[32,37,38,39,40].indexOf(t.keyCode)>-1&&t.preventDefault();var e=t.keyCode;38===e&&i.multiSelectArrows("up"),40===e&&i.multiSelectArrows("down"),37===e&&i.keyboardFolderToggle("close"),39===e&&i.keyboardFolderToggle("open")},this.processData=function(t){return $.isArray(t)?$.when(i.buildTree(t)).then(function(t){return i.treeData=t,p[i.treeData.id]=t,i.flatten(i.treeData.children)}).done(function(){i.calculateVisible(),i.calculateHeight(),i.initialized=!0,$.isFunction(i.options.ondataload)&&i.options.ondataload.call(i)}):e.request({method:"GET",url:t,config:i.options.xhrconfig,extract:function(t){return 200!==t.status?i.options.ondataloaderror(t):t.responseText}}).then(function(t){i.options.lazyLoadPreprocess&&(t=i.options.lazyLoadPreprocess.call(i,t)),i.treeData=i.buildTree(t)}).then(function(){p[i.treeData.id]=i.treeData,i.flatten(i.treeData.children)}).then(function(){i.calculateVisible(),i.calculateHeight(),i.initialized=!0,$.isFunction(i.options.ondataload)&&i.options.ondataload.call(i)}),i.flatData},this.buildTree=function(t,e){var o,n,s,r,a;if(Array.isArray(t)?(o=new l,n=t):(o=new l(t),n=t.children,o.depth=e.depth+1),n)for(s=n.length,a=0;s>a;a++)r=i.buildTree(n[a],o),o.add(r);return o},this.flatten=function(t,o){return i.flatData=[],function n(t,e){$.each(t,function(t,o){p[o.id]=o,i.flatData.push({show:e,id:o.id,row:o.data,depth:o.depth}),o.children.length>0&&n(o.children,e&&o.open)})}(t,!0),i.calculateVisible(o),i.calculateHeight(),e.redraw(!0),i.options.redrawComplete&&i.options.redrawComplete.call(i),t},this.onScroll=h(function(){var t=i.visibleIndexes.length;if(!i.options.paginate){if(t>i.options.naturalScrollLimit){e.startComputation();var o,n,s,r,a,l=$(this);n=i.calculateHeight(),s=l.children(".tb-tbody-inner").outerHeight(),o=l.scrollTop(),r=o/s*100,a=Math.floor(r/100*t),i.rangeMargin=a*i.options.rowHeight,i.refreshRange(a,!1),i.lastLocation=o,i.highlightMultiselect(),e.endComputation()}i.options.onscrollcomplete&&i.options.onscrollcomplete.call(i)}},this.options.scrollDebounce),this.init=function(t,o){function s(){var t,e=l.width(),o=0;d.each(function(n){var s,r=$(this);r.attr("data-tb-size",r.outerWidth()),n===i.select(".tb-th").length-1?(s=100-o,i.colsizes[r.attr("data-tb-th-col")]=s,r.css("width",s+"%")):(t=r.outerWidth()/e*100,i.colsizes[r.attr("data-tb-th-col")]=t,r.css("width",t+"%")),o+=t})}function r(){var t=l.width(),e=0;d.each(function(o){var n,s=$(this),r=t-e-1;o===i.select(".tb-th").length-1?s.css("width",r+"px"):(n=s.outerWidth(),s.css("width",n),e+=n)})}var a=i.select("#tb-tbody").height(),l=i.select(".tb-row-titles"),d=i.select(".tb-th");i.options.showTotal=i.options.naturalScrollLimit?i.options.naturalScrollLimit:Math.floor(a/i.options.rowHeight)+1,i.remainder=a/i.options.rowHeight+i.options.rowHeight,i.options.allowMove&&i.moveOn(),o||(i.initializeMove(),i.options.rowHeight||(i.options.rowHeight=i.select(".tb-row").height()),i.select(".gridWrapper").mouseleave(function(){i.select(".tb-row").removeClass(i.options.hoverClass)}),i.select("#tb-tbody").scroll(i.onScroll),i.select(".tb-th.tb-resizable").resizable({containment:"parent",delay:200,handles:"e",minWidth:60,start:function(){r()},create:function(){i.select(".ui-resizable-e").css({cursor:"col-resize"})},resize:function(t,e){var o,n,s,r,a,c,h,p,u,f,g=$(this),v=$(this).attr("data-tb-th-col"),w=d.length,b=l.width()-1,m=0;if(d.each(function(){m+=$(this).outerWidth()}),m>b){if(a=m-b,o=d.not(e.element).filter(function(){var t=parseInt($(e.element).attr("data-tb-th-col")),o=parseInt($(this).attr("data-tb-th-col"));return o>t?$(this).outerWidth()>40:!1}).first(),!(o.length>0))return void $(e.element).css({width:$(e.element).attr("data-tb-currentSize")+"px"});h=o.outerWidth(),o.css({width:h-a+"px"}),n=o.attr("data-tb-th-col"),i.select(".tb-col-"+n).css({width:h-a+"px"})}b>m&&(c=b-m,s=d.not(e.element).filter(function(){var t=$(this);return t.outerWidth()<parseInt(t.attr("data-tb-size"))}).last(),s.length>0?(p=s.outerWidth(),s.css({width:p+c+"px"}),r=s.attr("data-tb-th-col"),i.select(".tb-col-"+r).css({width:p+c+"px"})):(p=d.last().outerWidth(),d.last().css({width:p+c+"px"}).attr("data-tb-size",p+c))),u=d.last().width(),i.select(".tb-col-"+(w-1)).css("width",u+"px"),$(e.element).attr("data-tb-currentSize",$(e.element).outerWidth()),f=g.outerWidth(),i.select(".tb-col-"+v).css({width:f+"px"})},stop:function(){s(),e.redraw(!0)}}),i.options.uploads&&n(),$.isFunction(i.options.onload)&&i.options.onload.call(i),$(window).on("keydown",function(t){i.options.allowArrows&&1===i.multiselected().length&&i.handleArrowKeys(t)}),i.options.multiselect&&($(window).keydown(function(t){i.pressedKey=t.keyCode}),$(window).keyup(function(){i.pressedKey=void 0})),$(window).keydown(function(t){i.modal.on&&27===t.keyCode&&i.modal.dismiss(),i.modal.on&&13===t.keyCode&&i.select(".tb-modal-footer .btn-success").trigger("click")}),window.onblur=i.resetKeyPress,$(window).resize(function(){i.setScrollMode()}),i.setScrollMode())},this.setScrollMode=function(){i.tableWidth(i.options.hScroll&&$("#"+i.options.divID).width()<i.options.hScroll?i.options.hScroll+"px;":"auto;")},this.resetKeyPress=function(){i.pressedKey=void 0},this.destroy=function(){for(var t=document.getElementById(i.options.divID),e=t.parentNode,n=t.cloneNode(!0);n.firstChild;)n.removeChild(n.firstChild);e.removeChild(t),e.appendChild(n),i.dropzone&&o()}},u.view=function(t,o){var n=t.flatData.length>0?t.flatData:t.processData(o.data());return e(".gridWrapper",{style:"overflow-x: auto"},[e(".tb-table",{style:"width:"+t.tableWidth()},[function(){return t.options.toolbarComponent?e.component(t.options.toolbarComponent,{treebeard:t,mode:null}):t.options.headerTemplate.call(t)}(),function(){return t.options.hideColumnTitles?void 0:e(".tb-row-titles",[t.options.columnTitles.call(t).map(function(o,n,i){var s,r,a="",l=".tb-resizable",d=t.colsizes[n]?t.colsizes[n]+"%":o.width;return t.options.resizeColumns||(l=""),n===i.length-1&&(l=""),o.sort&&(t.isSorted[n]||(t.isSorted[n]={asc:!1,desc:!1}),s=t.options.sortButtonSelector.up?t.options.sortButtonSelector.up:"i.fa.fa-sort-asc",r=t.options.sortButtonSelector.down?t.options.sortButtonSelector.down:"i.fa.fa-sort-desc",a=[e(s+".tb-sort-inactive.asc-btn.m-r-xs",{onclick:t.sortToggle.bind(n),"data-direction":"asc","data-sortType":o.sortType}),e(r+".tb-sort-inactive.desc-btn",{onclick:t.sortToggle.bind(n),"data-direction":"desc","data-sortType":o.sortType})]),e(".tb-th"+l,{style:"width: "+d,"data-tb-th-col":n},[e("span.m-r-sm",o.title),a])})])}(),e("#tb-tbody",{config:t.init},[function(){var o=e("button.close",{onclick:function(){t.modal.dismiss()}},[t.options.removeIcon()]);return t.modal.on?e(".tb-modal-shade",{config:t.modal.onmodalshow,style:"width:"+t.modal.width+"px; height:"+t.modal.height+"px;padding:"+t.modal.padding,onclick:function(){t.modal.dismiss()}},[e(".modal-content",{"class":t.modal.css,onclick:function(){return event.stopPropagation(),!0}},[function(){return t.modal.header?[e(".modal-header",[o,t.modal.header]),e(".modal-body",t.modal.content)]:[e(".modal-body",[o,t.modal.content])]}(),e(".modal-footer",t.modal.actions)])]):void 0}(),e(".tb-tbody-inner",{style:"height: "+t.innerHeight+"px;"},[e("",{style:"margin-top:"+t.rangeMargin+"px;"},[t.showRange.map(function(o,i){var s,r=t.options.oddEvenClass.odd,a=n[o],l=a.depth,d=a.id,c=p[d],h=a.row,u=c.css||"",f=t.options.resolveRows.call(t,c);return i%2===0&&(r=t.options.oddEvenClass.even),s=t.filterOn?20:20*(l-1),c.notify.on&&!c.notify.column?e(".tb-row",{style:"height: "+t.options.rowHeight+"px;"},[e(".tb-notify.alert-"+c.notify.type,{"class":c.notify.css},[e("span",c.notify.message)])]):e(".tb-row",{key:d,"class":u+" "+r,"data-id":d,"data-level":l,"data-index":o,"data-rIndex":i,style:"height: "+t.options.rowHeight+"px;",onclick:function(e){var o=$(e.target);o.hasClass("tb-toggle-icon")||o.hasClass("fa-plus")||o.hasClass("fa-minus")||(t.options.multiselect&&t.handleMultiselect(d,i,e),t.selected=d,t.options.onselectrow&&t.options.onselectrow.call(t,c,e))},onmouseover:function(e){t.mouseon=d,t.options.hoverClass&&!t.dragOngoing&&(t.select(".tb-row").removeClass(t.options.hoverClass),$(this).addClass(t.options.hoverClass)),t.options.onmouseoverrow&&t.options.onmouseoverrow.call(t,c,e)}},[f.map(function(n,i){var r,a,l=t.options.columnTitles.call(t)[i],p=n.css||"",u=t.colsizes[i]?t.colsizes[i]+"%":l.width;return r=e(".tb-td.tb-col-"+i,{"class":p,style:"width:"+u},[e("span",h[n.data])]),c.notify.on&&c.notify.column===i?e(".tb-td.tb-col-"+i,{style:"width:"+u},[e(".tb-notify.alert-"+c.notify.type,{"class":c.notify.css},[e("span",c.notify.message)])]):(n.folderIcons&&(a=n.custom?e("span.title-text",n.custom.call(t,c,n)):e("span.title-text",h[n.data]+" "),r=e(".tb-td.td-title.tb-col-"+i,{"data-id":d,"class":p,style:"padding-left: "+s+"px; width:"+u},[e("span.tb-td-first",function(){var n=[{id:1,css:"tb-expand-icon-holder",resolve:t.options.resolveIcon.call(t,c)},{id:2,css:"tb-toggle-icon",resolve:t.options.resolveToggle.call(t,c)}];return t.filterOn?e("span."+n[0].css,{key:n[0].id},n[0].resolve):[e("span."+n[1].css,{key:n[1].id,onclick:function(e){t.options.togglecheck.call(t,c)&&t.toggleFolder(o,e)}},n[1].resolve),e("span."+n[0].css,{key:n[0].id},n[0].resolve)]}()),a])),!n.folderIcons&&n.custom&&(r=e(".tb-td.tb-col-"+i,{"class":p,style:"width:"+u},[n.custom.call(t,c,n)])),r)})])})])])]),function(){return t.options.paginate||t.options.paginateToggle?e(".tb-footer",[e(".row",[e(".col-xs-4",function(){if(t.options.paginateToggle){var o="",n="";return t.options.paginate?n="active":o="active",e(".btn-group.padder-10",[e("button.tb-button.tb-scroll",{onclick:t.toggleScroll,"class":o},"Scroll"),e("button.tb-button.tb-paginate",{onclick:t.togglePaginate,"class":n},"Paginate")])}}()),e(".col-xs-8",[e(".padder-10",[function(){if(t.options.paginate){var o=t.visibleIndexes.length,n=Math.ceil(o/t.options.showTotal);return t.options.resolvePagination?t.options.resolvePagination.call(t,n,t.currentPage()):e(".tb-pagination.pull-right",[e("button.tb-pagination-prev.tb-button.m-r-sm",{onclick:t.pageDown},[e("i.fa.fa-chevron-left")]),e("input.tb-pagination-input.m-r-sm",{type:"text",style:"width: 30px;",onkeyup:function(e){var o=parseInt(e.target.value,10);t.goToPage(o)},value:t.currentPage()}),e("span.tb-pagination-span","/ "+n+" "),e("button.tb-pagination-next.tb-button",{onclick:t.pageUp},[e("i.fa.fa-chevron-right")])])}}()])])])]):void 0}()])])};var g=function(){this.divID="myGrid",this.filesData="small.json",this.rowHeight=void 0,this.paginate=!1,this.paginateToggle=!1,this.uploads=!1,this.multiselect=!1,this.naturalScrollLimit=50,this.columnTitles=function(){return[{title:"Title",width:"50%",sortType:"text",sort:!0},{title:"Author",width:"25%",sortType:"text"},{title:"Age",width:"10%",sortType:"number"},{title:"Actions",width:"15%"}]
},this.hideColumnTitles=!1,this.resolveRows=function(){return[{data:"title",folderIcons:!0,filter:!0}]},this.hScroll=400,this.filterPlaceholder="Search",this.resizeColumns=!0,this.hoverClass=void 0,this.hoverClassMultiselect="tb-multiselect",this.showFilter=!0,this.title=null,this.allowMove=!0,this.allowArrows=!1,this.moveClass=void 0,this.sortButtonSelector={},this.dragOptions={},this.dropOptions={},this.dragEvents={},this.dropEvents={},this.sortDepth=0,this.oddEvenClass={odd:"tb-odd",even:"tb-even"},this.onload=function(){},this.togglecheck=function(){return!0},this.filterTemplate=function(){var t=this;return e("input.pull-right.form-control[placeholder='"+t.options.filterPlaceholder+"'][type='text']",{style:"width:100%;display:inline;",onkeyup:t.filter,value:t.filterText()})},this.toolbarComponent=null,this.headerTemplate=function(){var t=this,o=n(t.options.title);if(t.options.showFilter||o){var i,s=e(".tb-head-title.col-xs-12.col-sm-6",{},o);i=t.options.filterFullWidth?"":t.options.title?".col-sm-6":".col-sm-6.col-sm-offset-6";var r=e(".tb-head-filter.col-xs-12"+i,{},[function(){return t.options.showFilter?t.options.filterTemplate.call(t):void 0}()]);return t.options.title?e(".tb-head",[s,r]):e(".tb-head",[r])}},this.onfilter=function(){},this.onfilterreset=function(){},this.createcheck=function(){return!0},this.oncreate=function(){},this.deletecheck=function(){return!0},this.ondelete=function(){},this.addcheck=function(){return!0},this.onadd=function(){},this.onselectrow=function(){},this.onbeforemultiselect=function(){},this.onmultiselect=function(){},this.onmouseoverrow=function(){},this.ontogglefolder=function(){},this.dropzone={url:null},this.dropzoneEvents={},this.resolveIcon=function(t){return"folder"===t.kind?t.open?e("i.fa.fa-folder-open-o"," "):e("i.fa.fa-folder-o"," "):t.data.icon?e("i.fa."+t.data.icon," "):e("i.fa.fa-file ")},this.removeIcon=function(){return e("i.fa.fa-remove")},this.resolveRefreshIcon=function(){return e("i.icon-refresh.icon-spin")},this.resolveToggle=function(t){var o=e("i.fa.fa-minus-square-o"," "),n=e("i.fa.fa-plus-square-o"," ");return"folder"===t.kind&&t.children.length>0?t.open?o:n:""},this.resolvePagination=function(t,o){return e("span",[e("span","Page: "),e("span.tb-pageCount",o),e("span"," / "+t)])},this.resolveUploadUrl=function(){return"/upload"},this.resolveLazyloadUrl=function(){return!1},this.lazyLoadError=function(){},this.lazyLoadOnLoad=function(){},this.ondataload=function(){},this.ondataloaderror=function(){},this.onbeforeselectwitharrow=function(){},this.onafterselectwitharrow=function(){},this.xhrconfig=function(){},this.scrollDebounce=15},v=function(t,o,n){var i=new g,s=$.extend(i,o);if(!t)return void console.error("Treebeard Error: No data was provided. Treebeard expects an array of objects.");var t=e.prop(t);return window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){e.redraw()},1e3),n?e.component(u,{data:t,options:s}):e.mount(document.getElementById(s.divID),e.component(u,{data:t,options:s}))};return v.Notify=d,v});